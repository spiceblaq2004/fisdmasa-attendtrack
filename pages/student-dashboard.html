<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard - FISDMASA AttendTrack</title>
    <link rel="stylesheet" href="../css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Existing styles remain the same, adding new ones below */

        /* Enhanced Statistics Cards */
        .stat-card {
            position: relative;
            overflow: hidden;
        }

        .stat-trend {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 0.8rem;
            padding: 3px 8px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .trend-up { background: #d1fae5; color: #065f46; }
        .trend-down { background: #fee2e2; color: #dc2626; }
        .trend-neutral { background: #f3f4f6; color: #6b7280; }

        /* Notification Badge */
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ef4444;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Enhanced Course Cards */
        .course-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #f3f4f6;
        }

        .course-credits {
            background: #f3f4f6;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            color: #6b7280;
        }

        /* Today's Classes Section */
        .todays-classes {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .class-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #dc2626;
            background: #f8fafc;
        }

        .class-item.current {
            background: #eff6ff;
            border-left-color: #3b82f6;
        }

        .class-time {
            font-weight: bold;
            color: var(--dark);
        }

        .class-status {
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-upcoming { background: #fef3c7; color: #92400e; }
        .status-ongoing { background: #dbeafe; color: #1e40af; }
        .status-completed { background: #d1fae5; color: #065f46; }

        /* Enhanced Quick Actions with Badges */
        .action-btn {
            position: relative;
        }

        /* Performance Chart Placeholder */
        .performance-chart {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin: 30px 0;
        }

        .chart-placeholder {
            height: 200px;
            background: #f8fafc;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6b7280;
            margin-top: 15px;
        }

        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            .stat-card,
            .course-card,
            .recent-attendance,
            .todays-classes,
            .performance-chart,
            .action-btn {
                background: #1f2937;
                color: #f9fafb;
            }
        }

        /* Print styles */
        @media print {
            .action-btn,
            .btn {
                display: none;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <i class="fas fa-fire-extinguisher"></i>
                <span>FISDMASA AttendTrack</span>
            </div>
            <div class="nav-links">
                <a href="attendance-history.html">Attendance History</a>
                <span id="userWelcome">Welcome, Student!</span>
                <a href="../index.html" class="login-btn logout-btn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </a>
            </div>
        </div>
    </nav>

    <div class="dashboard">
        <!-- Loading Overlay -->
        <div class="loading-overlay" id="loadingOverlay">
            <i class="fas fa-spinner fa-spin" style="font-size: 3rem; color: var(--primary); margin-bottom: 20px;"></i>
            <h3 style="color: var(--dark); margin-bottom: 10px;">Loading Your Dashboard</h3>
            <p style="color: var(--gray);">Preparing your attendance information...</p>
        </div>

        <div class="dashboard-header">
            <div class="welcome-message">
                <h1 id="studentName">Welcome, Student!</h1>
                <div class="student-info">
                    <strong>Index Number:</strong> <span id="studentIndex">Loading...</span> | 
                    <strong>Level:</strong> <span id="studentLevel">Loading...</span> | 
                    <strong>Department:</strong> FSDM
                </div>
                <p id="currentDateTime">Track your attendance and academic progress</p>
            </div>
            <div style="display: flex; gap: 10px; align-items: center;">
                <button class="btn btn-secondary" onclick="refreshDashboard()">
                    <i class="fas fa-sync-alt"></i>
                    Refresh
                </button>
                <a href="qr-scanner.html" class="btn btn-primary">
                    <i class="fas fa-qrcode"></i>
                    Scan QR Code
                </a>
            </div>
        </div>

        <!-- Today's Classes -->
        <div class="todays-classes" id="todaysClasses">
            <h2 style="margin-bottom: 20px;">
                <i class="fas fa-calendar-day"></i> Today's Schedule
            </h2>
            <div id="todaysClassesList">
                <!-- Today's classes will be loaded here -->
            </div>
        </div>

        <!-- Attendance Statistics -->
        <div class="attendance-stats" id="attendanceStats">
            <div class="stat-card">
                <div class="stat-number" id="overallAttendance">0%</div>
                <div class="stat-label">Overall Attendance</div>
                <div class="stat-trend trend-up" id="attendanceTrend">
                    <i class="fas fa-arrow-up"></i> 5%
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="classesAttended">0</div>
                <div class="stat-label">Classes Attended</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="classesMissed">0</div>
                <div class="stat-label">Classes Missed</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="onTimePercentage">0%</div>
                <div class="stat-label">On Time Rate</div>
            </div>
        </div>

        <!-- Performance Chart -->
        <div class="performance-chart">
            <h2 style="margin-bottom: 20px;">
                <i class="fas fa-chart-line"></i> Attendance Trend
            </h2>
            <div class="chart-placeholder" id="attendanceChart">
                <div style="text-align: center;">
                    <i class="fas fa-chart-bar" style="font-size: 3rem; margin-bottom: 10px; opacity: 0.5;"></i>
                    <p>Attendance analytics chart will be implemented soon</p>
                </div>
            </div>
        </div>

        <!-- Courses Section -->
        <h2 style="margin-bottom: 20px;">Your Courses</h2>
        <div class="courses-grid" id="coursesGrid">
            <!-- Courses will be loaded dynamically -->
        </div>

        <!-- Recent Attendance -->
        <div class="recent-attendance" id="recentAttendanceSection">
            <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 20px;">
                <h2 style="margin: 0;">Recent Attendance</h2>
                <a href="attendance-history.html" class="btn btn-outline" style="font-size: 0.9rem;">
                    View All <i class="fas fa-arrow-right"></i>
                </a>
            </div>
            <div id="recentAttendanceList">
                <!-- Recent attendance will be loaded here -->
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <a href="qr-scanner.html" class="action-btn">
                <i class="fas fa-qrcode"></i>
                <h3>Scan QR Code</h3>
                <p>Mark attendance for current class</p>
            </a>
            <a href="attendance-history.html" class="action-btn">
                <i class="fas fa-history"></i>
                <h3>Attendance History</h3>
                <p>View detailed attendance records</p>
            </a>
            <a href="#" class="action-btn" onclick="showFeatureMessage('Course materials will be available soon')">
                <i class="fas fa-book"></i>
                <h3>Course Materials</h3>
                <p>Access learning resources</p>
            </a>
            <a href="#" class="action-btn" onclick="showFeatureMessage('Timetable feature coming soon')">
                <i class="fas fa-calendar-alt"></i>
                <h3>Class Timetable</h3>
                <p>View your schedule</p>
            </a>
        </div>
    </div>

    <script>
        // Enhanced Student Dashboard System
        class StudentDashboard {
            constructor() {
                this.token = localStorage.getItem('authToken');
                this.user = JSON.parse(localStorage.getItem('user') || '{}');
                this.attendanceRecords = JSON.parse(localStorage.getItem('attendanceRecords') || '[]');
                this.init();
            }

            init() {
                if (!this.token || this.user.role !== 'student') {
                    window.location.href = 'login.html';
                    return;
                }

                this.showLoading(true);
                this.updateDateTime();
                this.loadDashboardData();
                this.setupEventListeners();
                
                // Update time every minute
                setInterval(() => this.updateDateTime(), 60000);
            }

            updateDateTime() {
                const now = new Date();
                const options = { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                };
                document.getElementById('currentDateTime').textContent = 
                    `Last updated: ${now.toLocaleDateString('en-US', options)}`;
            }

            loadDashboardData() {
                // Simulate API call delay
                setTimeout(() => {
                    this.updateUserInfo();
                    this.loadTodaysClasses();
                    this.loadCourses();
                    this.calculateStatistics();
                    this.loadRecentAttendance();
                    this.showLoading(false);
                }, 1500);
            }

            loadTodaysClasses() {
                const todaysList = document.getElementById('todaysClassesList');
                const today = new Date().getDay();
                
                // Map day numbers to course schedules
                const todaysSchedule = this.getTodaysSchedule(today);
                
                if (todaysSchedule.length === 0) {
                    todaysList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-calendar-check"></i>
                            <h3>No Classes Today</h3>
                            <p>Enjoy your day off! Check back tomorrow for your schedule.</p>
                        </div>
                    `;
                    return;
                }

                todaysList.innerHTML = '';
                
                todaysSchedule.forEach(classItem => {
                    const classElement = document.createElement('div');
                    classElement.className = `class-item ${classItem.status}`;
                    classElement.innerHTML = `
                        <div>
                            <strong>${classItem.course}</strong>
                            <div style="color: #6b7280; font-size: 0.9rem; margin-top: 5px;">
                                ${classItem.lecturer} â€¢ ${classItem.location}
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div class="class-time">${classItem.time}</div>
                            <div class="class-status status-${classItem.status}">
                                ${classItem.status.charAt(0).toUpperCase() + classItem.status.slice(1)}
                            </div>
                        </div>
                    `;
                    todaysList.appendChild(classElement);
                });
            }

            getTodaysSchedule(day) {
                // Mock schedule data - in real app, this would come from API
                const schedules = {
                    1: [ // Monday
                        { course: 'FSDM 301', lecturer: 'Dr. A. Mensah', time: '8:00 - 10:00 AM', location: 'Room 101', status: 'completed' },
                        { course: 'FSDM 307', lecturer: 'Dr. S. Appiah', time: '2:00 - 4:00 PM', location: 'Lab A', status: 'upcoming' }
                    ],
                    2: [ // Tuesday
                        { course: 'FSDM 303', lecturer: 'Dr. K. Owusu', time: '10:00 - 12:00 PM', location: 'Room 201', status: 'ongoing' }
                    ],
                    // Add other days as needed
                };

                return schedules[day] || [];
            }

            // Enhanced statistics calculation
            calculateStatistics() {
                const allRecords = this.attendanceRecords.filter(record => 
                    record.indexNumber === this.user.indexNumber
                );
                
                const totalClasses = this.getTotalClasses('FSDM 301') + this.getTotalClasses('FSDM 303') + 
                                   this.getTotalClasses('FSDM 305') + this.getTotalClasses('FSDM 307');
                const attendedClasses = allRecords.filter(record => record.status === 'present').length;
                const missedClasses = totalClasses - attendedClasses;
                const overallAttendance = totalClasses > 0 ? Math.round((attendedClasses / totalClasses) * 100) : 0;
                const onTimeRate = this.calculateOnTimeRate();

                document.getElementById('overallAttendance').textContent = `${overallAttendance}%`;
                document.getElementById('classesAttended').textContent = attendedClasses;
                document.getElementById('classesMissed').textContent = missedClasses;
                document.getElementById('onTimePercentage').textContent = `${onTimeRate}%`;

                // Update trends
                this.updateAttendanceTrend(overallAttendance);
                this.updateStatCards(overallAttendance);
            }

            calculateOnTimeRate() {
                // Mock on-time rate calculation
                const presentRecords = this.attendanceRecords.filter(record => 
                    record.status === 'present' && record.indexNumber === this.user.indexNumber
                );
                
                // Simulate 85% on-time rate for demo
                return presentRecords.length > 0 ? 85 : 0;
            }

            updateAttendanceTrend(currentAttendance) {
                const trendElement = document.getElementById('attendanceTrend');
                const previousAttendance = currentAttendance - 5; // Mock previous data
                
                if (currentAttendance > previousAttendance) {
                    trendElement.className = 'stat-trend trend-up';
                    trendElement.innerHTML = `<i class="fas fa-arrow-up"></i> ${currentAttendance - previousAttendance}%`;
                } else if (currentAttendance < previousAttendance) {
                    trendElement.className = 'stat-trend trend-down';
                    trendElement.innerHTML = `<i class="fas fa-arrow-down"></i> ${previousAttendance - currentAttendance}%`;
                } else {
                    trendElement.className = 'stat-trend trend-neutral';
                    trendElement.innerHTML = `<i class="fas fa-minus"></i> 0%`;
                }
            }

            // Keep existing methods and add enhancements...
            // [Previous methods remain the same: updateUserInfo, loadCourses, calculateCourseAttendance, etc.]

            setupEventListeners() {
                // Logout button
                document.querySelector('.logout-btn').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.logout();
                });

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey && e.key === 'r') {
                        e.preventDefault();
                        this.refreshDashboard();
                    }
                });
            }

            refreshDashboard() {
                this.showLoading(true);
                setTimeout(() => {
                    this.loadDashboardData();
                    showFeatureMessage('Dashboard refreshed successfully');
                }, 1000);
            }

            logout() {
                localStorage.removeItem('authToken');
                localStorage.removeItem('user');
                window.location.href = '../index.html';
            }

            showLoading(show) {
                const overlay = document.getElementById('loadingOverlay');
                overlay.style.display = show ? 'flex' : 'none';
            }
        }

        function showFeatureMessage(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 100px;
                right: 20px;
                background: #0f766e;
                color: white;
                padding: 16px 20px;
                border-radius: 8px;
                z-index: 10000;
                box-shadow: 0 8px 25px rgba(0,0,0,0.15);
                max-width: 300px;
                font-weight: 500;
                transition: all 0.3s ease;
            `;
            notification.innerHTML = `<i class="fas fa-info-circle"></i> ${message}`;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                notification.style.opacity = '0';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        function refreshDashboard() {
            const dashboard = new StudentDashboard();
            dashboard.refreshDashboard();
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', () => {
            new StudentDashboard();
        });
    </script>
</body>
</html>